<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Dashboard Customer Daiku Interior - Kelola proyek desain interior, tracking progress, dan komunikasi dengan desainer.">
    <title>Dashboard Customer - Daiku Interior Pekanbaru</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-light">
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center w-100">
                <a href="index.html" class="navbar-brand">
                    <img src="images/image.png" alt="Daiku Interior & Eksterior" height="24">
                </a>
                
                <ul class="navbar-nav d-lg-flex">
                    <li><a href="index.html" class="nav-link">Beranda</a></li>
                    <li><a href="catalog.html" class="nav-link">Katalog</a></li>
                    <li><a href="rfq-form.html" class="nav-link">Konsultasi</a></li>
                    <li><a href="#" class="nav-link login-required active" style="display: none;" onclick="DaikuApp.goToDashboard(); return false;">Pesanan Saya</a></li>
                    <li class="guest-only"><a href="auth.html" class="nav-link">Login</a></li>
                    <li class="login-required dropdown" style="display: none;">
                        <a href="#" class="nav-link dropdown-toggle user-profile">
                            <img src="" alt="Profile" class="rounded-circle me-2" width="24" height="24">
                            <span class="user-name"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li class="customer-only"><a href="#" class="dropdown-item" onclick="DaikuApp.goToDashboard(); return false;">Dashboard</a></li>
                            <li class="admin-only" style="display: none;"><a href="admin-dashboard.html" class="dropdown-item">Admin Panel</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a href="#" class="dropdown-item" onclick="DaikuApp.logout()">Logout</a></li>
                        </ul>
                    </li>
                </ul>
                
                <button class="mobile-menu-toggle d-lg-none">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Dashboard Content -->
    <div class="dashboard-container py-4">
        <div class="container-fluid">
            <!-- Welcome Section -->
            <div class="welcome-section mb-4">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h1 class="h3 mb-2">Selamat Datang, <span id="welcomeName">Sari</span>! ðŸ‘‹</h1>
                        <p class="text-muted mb-0">Kelola proyek interior dan pantau progress dengan mudah</p>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <a href="rfq-form.html" class="btn btn-accent">
                            <i class="fas fa-plus me-2"></i>Proyek Baru
                        </a>
                        <a href="catalog.html" class="btn btn-outline-primary">
                            <i class="fas fa-images me-2"></i>Lihat Katalog
                        </a>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="stats-section mb-4">
                <div class="row">
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card stats-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="stats-icon bg-primary text-white rounded-circle me-3">
                                        <i class="fas fa-shopping-cart"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-0" id="totalOrders">2</h5>
                                        <small class="text-muted">Total Pesanan</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card stats-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="stats-icon bg-warning text-white rounded-circle me-3">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-0" id="activeProjects">1</h5>
                                        <small class="text-muted">Proyek Aktif</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card stats-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="stats-icon bg-success text-white rounded-circle me-3">
                                        <i class="fas fa-check-circle"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-0" id="completedProjects">1</h5>
                                        <small class="text-muted">Selesai</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-3 col-md-6 mb-3">
                        <div class="card stats-card">
                            <div class="card-body">
                                <div class="d-flex align-items-center">
                                    <div class="stats-icon bg-accent text-white rounded-circle me-3">
                                        <i class="fas fa-money-bill-wave"></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-0" id="totalInvestment">Rp 43jt</h5>
                                        <small class="text-muted">Total Investasi</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="row">
                <!-- Left Column -->
                <div class="col-lg-8">
                    <!-- Active Projects -->
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-tasks me-2"></i>Proyek Aktif
                            </h5>
                            <button class="btn btn-sm btn-outline-primary" onclick="refreshProjects()">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        <div class="card-body">
                            <div id="activeProjectsList">
                                <!-- Active projects will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Recent Orders -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-history me-2"></i>Riwayat Pesanan
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="ordersTable">
                                    <thead>
                                        <tr>
                                            <th>ID Pesanan</th>
                                            <th>Desain</th>
                                            <th>Status</th>
                                            <th>Total</th>
                                            <th>Tanggal</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Orders will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="col-lg-4">
                    <!-- Quick Actions -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-bolt me-2"></i>Aksi Cepat
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="d-grid gap-2">
                                <a href="rfq-form.html" class="btn btn-primary btn-sm">
                                    <i class="fas fa-plus me-2"></i>Pesan Desain Baru
                                </a>
                                <a href="catalog.html" class="btn btn-outline-secondary btn-sm">
                                    <i class="fas fa-eye me-2"></i>Lihat Portfolio
                                </a>
                                <button class="btn btn-outline-success btn-sm" onclick="openChat()">
                                    <i class="fas fa-comments me-2"></i>Chat dengan Tim
                                </button>
                                <a href="payment.html" class="btn btn-outline-warning btn-sm">
                                    <i class="fas fa-credit-card me-2"></i>Upload Bukti Bayar
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Messages -->
                    <div class="card mb-4">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">
                                <i class="fas fa-comments me-2"></i>Pesan Terbaru
                            </h6>
                            <a href="chat.html" class="btn btn-sm btn-outline-primary">Lihat Semua</a>
                        </div>
                        <div class="card-body">
                            <div id="recentMessages">
                                <!-- Recent messages will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Payment Status -->
                    <div class="card mb-4">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-credit-card me-2"></i>Status Pembayaran
                            </h6>
                        </div>
                        <div class="card-body">
                            <div id="paymentStatus">
                                <!-- Payment status will be loaded here -->
                            </div>
                        </div>
                    </div>

                    <!-- Support -->
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="fas fa-headset me-2"></i>Butuh Bantuan?
                            </h6>
                        </div>
                        <div class="card-body">
                            <p class="small text-muted mb-3">
                                Tim customer service kami siap membantu Anda 24/7
                            </p>
                            <div class="d-grid gap-2">
                                <a href="https://wa.me/6281234567890" class="btn btn-success btn-sm" target="_blank">
                                    <i class="fab fa-whatsapp me-2"></i>WhatsApp
                                </a>
                                <a href="tel:+6281234567890" class="btn btn-outline-primary btn-sm">
                                    <i class="fas fa-phone me-2"></i>Telepon
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Modal -->
    <div class="modal fade" id="notificationModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-bell me-2"></i>Notifikasi
                    </h5>
                    <button type="button" class="btn-close" data-modal-close></button>
                </div>
                <div class="modal-body">
                    <div id="notificationsList">
                        <!-- Notifications will be loaded here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" onclick="markAllAsRead()">
                        Tandai Semua Dibaca
                    </button>
                    <button type="button" class="btn btn-secondary" data-modal-close>
                        Tutup
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Detail Modal -->
    <div class="modal fade" id="orderDetailModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Detail Pesanan</h5>
                    <button type="button" class="btn-close" data-modal-close></button>
                </div>
                <div class="modal-body" id="orderDetailContent">
                    <!-- Order details will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-modal-close">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/data.js"></script>
    <script src="js/main.js"></script>
    <script>
        class CustomerDashboard {
            constructor() {
                this.currentUser = null;
                this.orders = [];
                this.notifications = [];
            }

            init() {
                // If checkAuthentication returns false, don't continue initialization
                if (!this.checkAuthentication()) {
                    return;
                }
                this.loadUserData();
                this.loadDashboardData();
                this.bindEvents();
            }

            checkAuthentication() {
                const userStr = localStorage.getItem('daiku_currentUser');
                if (!userStr) {
                    window.location.href = 'auth.html';
                    return false;
                }

                this.currentUser = JSON.parse(userStr);
                if (this.currentUser.role !== 'customer') {
                    // Redirect to appropriate dashboard
                    if (this.currentUser.role === 'admin') {
                        window.location.href = 'admin-dashboard.html';
                        return false;
                    } else if (this.currentUser.role === 'designer') {
                        window.location.href = 'designer-dashboard.html';
                        return false;
                    }
                    return false;
                }

                this.updateUserInterface();
                return true;
            }

            updateUserInterface() {
                // Update user name displays
                document.getElementById('userNameDisplay').textContent = this.currentUser.name;
                const firstName = this.currentUser.name.split(' ')[0];
                document.getElementById('welcomeName').textContent = firstName;

                // Update user avatar
                const avatarImg = document.querySelector('.navbar img');
                if (avatarImg && this.currentUser.avatar) {
                    avatarImg.src = this.currentUser.avatar;
                }
            }

            loadUserData() {
                // Load user-specific data
                const allOrders = StorageManager.getData('orders', []);
                this.orders = allOrders.filter(order => order.customerId === this.currentUser.id);

                const allNotifications = StorageManager.getData('notifications', []);
                this.notifications = allNotifications.filter(notif => notif.userId === this.currentUser.id);
            }

            loadDashboardData() {
                this.updateStats();
                this.loadActiveProjects();
                this.loadOrdersTable();
                this.loadRecentMessages();
                this.loadPaymentStatus();
                this.loadNotifications();
            }

            bindEvents() {
                // Auto-refresh every 30 seconds
                setInterval(() => {
                    this.loadUserData();
                    this.updateStats();
                    this.loadActiveProjects();
                }, 30000);
            }

            updateStats() {
                const totalOrders = this.orders.length;
                const activeProjects = this.orders.filter(order => 
                    order.status === 'in_progress' || order.status === 'pending').length;
                const completedProjects = this.orders.filter(order => order.status === 'completed').length;
                const totalInvestment = this.orders.reduce((total, order) => total + order.totalAmount, 0);

                document.getElementById('totalOrders').textContent = totalOrders;
                document.getElementById('activeProjects').textContent = activeProjects;
                document.getElementById('completedProjects').textContent = completedProjects;
                document.getElementById('totalInvestment').textContent = Utils.formatCurrency(totalInvestment);
            }

            loadActiveProjects() {
                const activeOrders = this.orders.filter(order => 
                    order.status === 'in_progress' || order.status === 'pending');
                
                const container = document.getElementById('activeProjectsList');
                
                if (activeOrders.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-4">
                            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                            <h6>Tidak ada proyek aktif</h6>
                            <p class="text-muted">Mulai proyek interior impian Anda sekarang!</p>
                            <a href="rfq-form.html" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>Buat Proyek Baru
                            </a>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = activeOrders.map(order => `
                    <div class="project-card mb-3 p-3 border rounded">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div>
                                <h6 class="mb-1">${order.designTitle}</h6>
                                <small class="text-muted">ID: ${order.id}</small>
                            </div>
                            <span class="badge ${this.getStatusBadgeClass(order.status)}">${this.getStatusText(order.status)}</span>
                        </div>
                        
                        <div class="progress mb-2" style="height: 8px;">
                            <div class="progress-bar" role="progressbar" 
                                 style="width: ${order.progressPercentage}%" 
                                 aria-valuenow="${order.progressPercentage}" 
                                 aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <small class="text-muted">Progress: ${order.progressPercentage}%</small><br>
                                <small class="text-muted">
                                    <i class="fas fa-user me-1"></i>${order.designerName}
                                </small>
                            </div>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="customerDashboard.viewOrderDetail('${order.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-success" onclick="openChat('${order.id}')">
                                    <i class="fas fa-comments"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            loadOrdersTable() {
                const tbody = document.querySelector('#ordersTable tbody');
                
                if (this.orders.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center py-4">
                                <i class="fas fa-inbox fa-2x text-muted mb-2"></i><br>
                                Belum ada pesanan
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = this.orders.map(order => `
                    <tr>
                        <td>
                            <span class="font-weight-medium">${order.id}</span><br>
                            <small class="text-muted">${Utils.formatDate(order.orderDate)}</small>
                        </td>
                        <td>
                            <div class="text-truncate" style="max-width: 200px;">
                                ${order.designTitle}
                            </div>
                            <small class="text-muted">${order.area}</small>
                        </td>
                        <td>
                            <span class="badge ${this.getStatusBadgeClass(order.status)}">
                                ${this.getStatusText(order.status)}
                            </span>
                        </td>
                        <td>
                            <span class="font-weight-medium">${Utils.formatCurrency(order.totalAmount)}</span><br>
                            <small class="text-muted">${this.getPaymentStatusText(order.paymentStatus)}</small>
                        </td>
                        <td>
                            <span>${Utils.formatDate(order.startDate || order.orderDate)}</span>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="customerDashboard.viewOrderDetail('${order.id}')"
                                        title="Lihat Detail">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn btn-outline-success" onclick="openChat('${order.id}')"
                                        title="Chat">
                                    <i class="fas fa-comments"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            }

            loadRecentMessages() {
                const allMessages = StorageManager.getData('chats', []);
                const userMessages = allMessages
                    .filter(msg => {
                        const userOrders = this.orders.map(o => o.id);
                        return userOrders.includes(msg.orderId);
                    })
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                    .slice(0, 3);

                const container = document.getElementById('recentMessages');
                
                if (userMessages.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-muted">
                            <i class="fas fa-comments fa-2x mb-2"></i><br>
                            <small>Belum ada pesan</small>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = userMessages.map(msg => `
                    <div class="message-item mb-3 p-2 border-start border-3 ${msg.senderType === 'customer' ? 'border-primary' : 'border-success'}">
                        <div class="d-flex justify-content-between align-items-start mb-1">
                            <small class="font-weight-medium text-primary">
                                ${msg.senderType === 'customer' ? 'Anda' : msg.senderName}
                            </small>
                            <small class="text-muted">${Utils.formatRelativeTime(msg.timestamp)}</small>
                        </div>
                        <p class="mb-0 small">${msg.message}</p>
                        ${!msg.read && msg.senderType !== 'customer' ? '<span class="badge badge-primary badge-sm">Baru</span>' : ''}
                    </div>
                `).join('');
            }

            loadPaymentStatus() {
                const allPayments = StorageManager.getData('payments', []);
                const userOrderIds = this.orders.map(o => o.id);
                const userPayments = allPayments.filter(p => userOrderIds.includes(p.orderId));

                const container = document.getElementById('paymentStatus');
                
                if (userPayments.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-muted">
                            <i class="fas fa-credit-card fa-2x mb-2"></i><br>
                            <small>Belum ada pembayaran</small>
                        </div>
                    `;
                    return;
                }

                const pendingPayments = userPayments.filter(p => p.status === 'pending');
                const verifiedPayments = userPayments.filter(p => p.status === 'verified');

                container.innerHTML = `
                    <div class="payment-summary">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>Verified</span>
                            <span class="badge bg-success">${verifiedPayments.length}</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span>Pending</span>
                            <span class="badge bg-warning">${pendingPayments.length}</span>
                        </div>
                        ${pendingPayments.length > 0 ? `
                            <div class="alert alert-warning alert-sm mt-3">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <small>Ada ${pendingPayments.length} pembayaran menunggu verifikasi</small>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            loadNotifications() {
                const unreadCount = this.notifications.filter(n => !n.read).length;
                const badge = document.querySelector('.notification-badge');
                
                if (unreadCount > 0) {
                    badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                    badge.style.display = 'inline-block';
                } else {
                    badge.style.display = 'none';
                }

                const container = document.getElementById('notificationsList');
                
                if (this.notifications.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-muted py-3">
                            <i class="fas fa-bell-slash fa-2x mb-2"></i><br>
                            Tidak ada notifikasi
                        </div>
                    `;
                    return;
                }

                container.innerHTML = this.notifications
                    .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))
                    .map(notif => `
                        <div class="notification-item ${!notif.read ? 'unread' : ''} p-3 border-bottom">
                            <div class="d-flex">
                                <div class="notification-icon me-3">
                                    <i class="fas ${this.getNotificationIcon(notif.type)} text-primary"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1">${notif.title}</h6>
                                    <p class="mb-1 text-muted">${notif.message}</p>
                                    <small class="text-muted">${Utils.formatRelativeTime(notif.timestamp)}</small>
                                </div>
                                ${!notif.read ? '<div class="unread-indicator bg-primary rounded-circle"></div>' : ''}
                            </div>
                        </div>
                    `).join('');
            }

            viewOrderDetail(orderId) {
                const order = this.orders.find(o => o.id === orderId);
                if (!order) return;

                const content = document.getElementById('orderDetailContent');
                content.innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Informasi Pesanan</h6>
                            <table class="table table-borderless table-sm">
                                <tr><td>ID Pesanan:</td><td class="font-weight-medium">${order.id}</td></tr>
                                <tr><td>Status:</td><td><span class="badge ${this.getStatusBadgeClass(order.status)}">${this.getStatusText(order.status)}</span></td></tr>
                                <tr><td>Tanggal Pesan:</td><td>${Utils.formatDate(order.orderDate)}</td></tr>
                                <tr><td>Estimasi Selesai:</td><td>${order.estimatedCompletion ? Utils.formatDate(order.estimatedCompletion) : '-'}</td></tr>
                                <tr><td>Progress:</td><td>${order.progressPercentage}%</td></tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h6>Detail Proyek</h6>
                            <table class="table table-borderless table-sm">
                                <tr><td>Desain:</td><td class="font-weight-medium">${order.designTitle}</td></tr>
                                <tr><td>Desainer:</td><td>${order.designerName}</td></tr>
                                <tr><td>Luas Area:</td><td>${order.area}</td></tr>
                                <tr><td>Alamat:</td><td>${order.address}</td></tr>
                            </table>
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Rincian Biaya</h6>
                            <table class="table table-borderless table-sm">
                                <tr><td>Total Biaya:</td><td class="font-weight-bold text-primary">${Utils.formatCurrency(order.totalAmount)}</td></tr>
                                <tr><td>DP Dibayar:</td><td class="text-success">${Utils.formatCurrency(order.downPayment)}</td></tr>
                                <tr><td>Sisa Pembayaran:</td><td class="text-warning">${Utils.formatCurrency(order.remainingPayment)}</td></tr>
                                <tr><td>Status Bayar:</td><td><span class="badge ${this.getPaymentStatusBadgeClass(order.paymentStatus)}">${this.getPaymentStatusText(order.paymentStatus)}</span></td></tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <h6>Catatan Proyek</h6>
                            <p class="text-muted">${order.notes || 'Tidak ada catatan khusus'}</p>
                            
                            <div class="mt-3">
                                <button class="btn btn-primary btn-sm me-2" onclick="openChat('${order.id}')">
                                    <i class="fas fa-comments me-1"></i>Chat Desainer
                                </button>
                                ${order.remainingPayment > 0 ? `
                                    <a href="payment.html?order=${order.id}" class="btn btn-warning btn-sm">
                                        <i class="fas fa-credit-card me-1"></i>Bayar
                                    </a>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;

                DaikuApp.showModal('orderDetailModal');
            }

            getStatusBadgeClass(status) {
                const classes = {
                    'pending': 'badge-warning',
                    'in_progress': 'badge-primary',
                    'completed': 'badge-success',
                    'cancelled': 'badge-danger'
                };
                return classes[status] || 'badge-secondary';
            }

            getStatusText(status) {
                const texts = {
                    'pending': 'Menunggu',
                    'in_progress': 'Dalam Progress',
                    'completed': 'Selesai',
                    'cancelled': 'Dibatalkan'
                };
                return texts[status] || status;
            }

            getPaymentStatusBadgeClass(status) {
                const classes = {
                    'unpaid': 'badge-danger',
                    'partial': 'badge-warning',
                    'paid': 'badge-success'
                };
                return classes[status] || 'badge-secondary';
            }

            getPaymentStatusText(status) {
                const texts = {
                    'unpaid': 'Belum Bayar',
                    'partial': 'Sebagian',
                    'paid': 'Lunas'
                };
                return texts[status] || status;
            }

            getNotificationIcon(type) {
                const icons = {
                    'order_update': 'fa-tasks',
                    'payment_reminder': 'fa-credit-card',
                    'new_message': 'fa-comment',
                    'project_complete': 'fa-check-circle'
                };
                return icons[type] || 'fa-bell';
            }
        }

        // Global functions
        function refreshProjects() {
            customerDashboard.loadActiveProjects();
            DaikuApp.showToast('Refreshed', 'Data proyek telah diperbarui', 'success');
        }

        function openChat(orderId = null) {
            const chatUrl = orderId ? `chat.html?order=${orderId}` : 'chat.html';
            window.location.href = chatUrl;
        }

        function markAllAsRead() {
            customerDashboard.notifications.forEach(notif => notif.read = true);
            
            // Update stored notifications
            const allNotifications = StorageManager.getData('notifications', []);
            const updatedNotifications = allNotifications.map(notif => {
                if (notif.userId === customerDashboard.currentUser.id) {
                    notif.read = true;
                }
                return notif;
            });
            StorageManager.setData('notifications', updatedNotifications);
            
            customerDashboard.loadNotifications();
            DaikuApp.showToast('Success', 'Semua notifikasi ditandai sebagai dibaca', 'success');
        }

        function logout() {
            localStorage.removeItem('daiku_currentUser');
            DaikuApp.showToast('Logout', 'Anda telah logout', 'info');
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 1000);
        }

        // Initialize dashboard
        const customerDashboard = new CustomerDashboard();
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            if (!DaikuApp.currentUser || !DaikuApp.isAuthenticated) {
                window.location.href = 'auth.html';
                return;
            }

            // Redirect admin users to admin dashboard
            if (DaikuApp.currentUser.role === 'admin') {
                window.location.href = 'admin-dashboard.html';
                return;
            }

            // Only customers and designers can access this dashboard
            if (!['customer', 'designer'].includes(DaikuApp.currentUser.role)) {
                window.location.href = 'auth.html';
                return;
            }

            customerDashboard.init();
        });
    </script>

    <style>
        .stats-card {
            transition: transform 0.2s ease;
        }
        
        .stats-card:hover {
            transform: translateY(-2px);
        }
        
        .stats-icon {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .project-card {
            transition: all 0.2s ease;
        }
        
        .project-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            font-size: 0.7rem;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            display: none;
        }
        
        .notification-item.unread {
            background-color: rgba(52, 152, 219, 0.05);
            border-left: 3px solid var(--primary-color);
        }
        
        .unread-indicator {
            width: 8px;
            height: 8px;
            margin-top: 4px;
        }
        
        .message-item {
            font-size: 0.875rem;
        }
        
        .alert-sm {
            padding: 0.5rem;
            font-size: 0.8rem;
        }
        
        .payment-summary {
            font-size: 0.9rem;
        }
        
        .dropdown-menu {
            border: none;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .table td {
            padding: 0.5rem;
            border: none;
        }
        
        .table th {
            font-weight: 600;
            color: var(--primary-color);
            border-bottom: 2px solid #dee2e6;
        }
        
        @media (max-width: 767.98px) {
            .welcome-section .col-md-4 {
                text-align: center !important;
                margin-top: 1rem;
            }
            
            .stats-section .col-lg-3 {
                margin-bottom: 1rem;
            }
            
            .table-responsive table {
                min-width: 600px;
            }
            
            .project-card .btn-group {
                flex-direction: column;
                width: 100%;
            }
            
            .project-card .btn-group .btn {
                border-radius: 0.375rem !important;
                margin-bottom: 0.25rem;
            }
        }
    </style>
</body>
</html>